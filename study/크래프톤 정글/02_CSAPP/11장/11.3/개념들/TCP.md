---
date: 2025-10-31
tags: [Network]
---

# TCP (Transmission Control Protocol)

## 정의

TCP는 인터넷 프로토콜 스택의 전송 계층(Transport Layer)에서 동작하는  
**연결 지향형(Connection-oriented)**, **신뢰성 있는 전송 프로토콜**이다. 
데이터를 전송하기 전에 송신자와 수신자가 연결을 설정하고,  
전송 중 손실되거나 순서가 바뀐 데이터를 복구하여  
**정확하고 순서가 유지된 데이터 흐름(stream)** 을 보장한다.

---

## 주요 특징

- **연결 지향형**  
    데이터 전송 전 3-way handshake 과정을 통해 연결을 설정하고,  
    전송이 끝나면 4-way handshake로 연결을 종료한다.
    
- **[[신뢰성 보장]]**  
    전송 중 손실, 중복, 순서 뒤바뀜을 감지하고 자동으로 재전송한다.
    수신자는 받은 데이터에 대해 ACK(확인 응답)을 전송한다.
    
- **흐름 제어 (Flow Control)** 
    수신자의 처리 속도와 버퍼 크기에 맞춰 송신 속도를 조절한다.  
    → 수신 측 버퍼 초과로 인한 손실 방지.  
    **슬라이딩 윈도우(Sliding Window)** 메커니즘을 사용해  
    수신자가 `Window Size` 필드로 여유 버퍼 크기를 알리고,  
    송신자는 그 크기 내에서만 데이터를 전송한다.
    
- **[[혼잡 제어]] (Congestion Control)**  
    네트워크가 과부하 상태일 때 전송 속도를 줄여 혼잡을 완화한다.  
    → 네트워크 전체 성능 유지.  
    TCP는 **혼잡 윈도우(cwnd)** 를 사용해 전송량을 제한하며,  
    네트워크 손실(=혼잡 신호)이 감지되면 전송 속도를 줄인다.  
    **Slow Start → Congestion Avoidance → Fast Retransmit → Fast Recovery**  
    단계를 반복하며 네트워크 상태에 따라 동적으로 조정한다.
    
- **스트림 지향 (Byte Stream)**  
    데이터를 패킷 단위로 나누지 않고 **연속된 바이트 흐름(stream)** 으로 다룬다.  
    → 응용 계층에서는 하나의 긴 데이터 흐름처럼 사용 가능.  
    따라서 TCP는 메시지의 경계를 보존하지 않으며, 
    상위 프로토콜(HTTP, SMTP 등)이 “\r\n\r\n” 등으로 경계를 직접 정의한다.
    
- **재전송 메커니즘 (Retransmission)**  
    송신자는 각 세그먼트의 ACK을 기다리며,  
    일정 시간(=RTO) 안에 ACK이 오지 않으면 **자동 재전송**한다.  
    중복 ACK이 여러 번 도착할 경우,  
    타이머를 기다리지 않고 **Fast Retransmit(빠른 재전송)** 으로 즉시 복구한다.
    

---

## 헤더 구조

| 필드                    | 크기    | 설명                    |
| --------------------- | ----- | --------------------- |
| Source Port           | 16bit | 송신 포트 번호              |
| Destination Port      | 16bit | 수신 포트 번호              |
| Sequence Number       | 32bit | 데이터 순서를 식별 (순서 복원용)   |
| Acknowledgment Number | 32bit | 수신 확인용 번호 (ACK 응답)    |
| Data Offset           | 4bit  | 헤더 길이 정보              |
| Control Flags         | 6bit  | SYN, ACK, FIN 등 제어 신호 |
| Window Size           | 16bit | 흐름 제어용 버퍼 크기          |
| Checksum              | 16bit | 데이터 오류 검출             |
| Urgent Pointer        | 16bit | 긴급 데이터 위치 표시          |

---

## 연결 과정

### 1️⃣ 연결 설정 (3-Way Handshake)

1. 클라이언트 → 서버 : **SYN**
    
2. 서버 → 클라이언트 : **SYN + ACK**
    
3. 클라이언트 → 서버 : **ACK**  
    → 연결이 성립됨.
    

---

### 2️⃣ 데이터 전송

- 송신자는 데이터를 세그먼트 단위로 나누어 전송한다.
    
- 각 세그먼트에는 **시퀀스 번호(Sequence Number)** 가 붙는다.
    
- 수신자는 **ACK 번호**로 "여기까지 잘 받았음"을 알린다.
    
- 누락된 세그먼트가 감지되면 **재전송 요청** 또는 **타임아웃 후 재전송**이 발생한다.
    
- 수신자는 순서를 복원하여 **정확한 바이트 스트림**으로 상위 계층에 전달한다.
    

---

### 3️⃣ 연결 종료 (4-Way Handshake)

1. 송신자 → 수신자 : **FIN**
    
2. 수신자 → 송신자 : **ACK**
    
3. 수신자 → 송신자 : **FIN**
    
4. 송신자 → 수신자 : **ACK**  
    → 연결이 완전히 종료된다.
    

---

## RTT & RTO (재전송 타이머)

- **RTT (Round Trip Time)**  
    : 패킷을 보내고 ACK이 돌아오기까지의 실제 왕복 시간.  
    → 네트워크의 현재 지연 상태를 반영.
    
- **RTO (Retransmission Timeout)**  
    : ACK이 일정 시간 안 오면 재전송을 시작하는 기준 시간.  
    → `RTO ≈ 평균 RTT + 여유값` 으로 계산.  
    → 너무 짧으면 불필요한 재전송, 너무 길면 반응 느림.  
    TCP는 RTT 변화를 학습하여 RTO를 **자동으로 조정**한다.
    

---

## 장점

- 데이터 전송의 **신뢰성과 정확성 보장**
    
- 순서 보장 및 재전송 기능 내장
    
- 혼잡 제어 및 흐름 제어를 통한 네트워크 효율 유지
    
- 응용 계층에서 별도의 오류 제어 로직 불필요
    

---

## 단점

- 연결 설정 및 유지로 인한 **지연(latency)** 증가
    
- 패킷 손실 시 **재전송으로 인한 속도 저하**
    
- 대규모 **실시간 스트리밍, 게임, VoIP** 등에는 비효율적
    

---

## 사용 사례

- 웹 통신 (HTTP, HTTPS)
    
- 이메일 (SMTP, IMAP, POP3)
    
- 파일 전송 (FTP, SFTP)
    
- 원격 접속 (SSH, Telnet)
    
- 신뢰성이 중요한 모든 데이터 통신 환경
    

---

## 요약

> TCP는 **정확성·순서·신뢰성**을 보장하기 위한 전송 프로토콜이다.  
> 3-Way Handshake로 연결을 맺고,  
> 흐름 제어와 혼잡 제어로 네트워크 상태를 조절하며,  
> 손실 시 재전송과 ACK으로 신뢰성을 확보한다.
> 
> **RTT와 RTO를 이용해 지연을 예측하고,  
> 순서가 뒤섞인 세그먼트를 복원하여  
> 완전한 데이터 스트림을 제공한다.**