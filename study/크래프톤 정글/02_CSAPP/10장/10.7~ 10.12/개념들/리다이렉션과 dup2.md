---
date: 2025-10-30
---

**I/O 리다이렉션** 은 표준 입력(stdin), 표준 출력(stdout), 표준 에러(stderr)의 기본 경로를 다른 파일로 바꾸는 기능입니다. 이 기능은 `dup2` 시스템 콜을 통해 구현됩니다.

- **`dup2(oldfd, newfd)` 함수의 동작**:
    
    1. 이 함수는 `oldfd`의 디스크립터 테이블 항목을 `newfd`의 디스크립터 테이블 항목 위치로 복사합니다.
        
    2. 만약 `newfd`가 이미 열려 있는 파일이었다면, 복사하기 전에 먼저 그 파일을 닫습니다.
        
    3. 복사 후, `newfd`는 `oldfd`가 가리키던 것과 **동일한 파일 테이블 항목**을 가리키게 됩니다.
        
    4. 그 결과, 원래 `oldfd`가 가리키던 파일의 **참조 카운트는 1 증가**하고, `newfd`가 가리키던 파일의 참조 카운트는 1 감소합니다.
        
- **셸의 리다이렉션 예시 (`ls > foo.txt`):**
    
    1. 셸은 `foo.txt` 파일을 쓰기 모드로 열고, 새로운 파일 디스크립터(예: `fd 4`)를 받습니다.
        
    2. 그다음 `dup2(4, 1)`을 호출합니다. 여기서 `fd 1`은 **표준 출력**입니다.
        
    3. 이 호출로 인해, 표준 출력(fd 1)은 이제 화면 대신 `foo.txt` 파일을 가리키게 됩니다.
        
    4. 이 상태에서 `ls` 프로그램을 실행하면, `ls`가 표준 출력으로 보내는 모든 결과는 화면이 아닌 `foo.txt` 파일에 기록됩니다.