---
date: 2025-11-03
tags: [CS]
---


### 1. ğŸ ì˜¤ì „ (10:00 ~ 13:00): 2ë‹¨ê³„(ë™ì‹œì„±) ì™„ë²½í•˜ê²Œ ì•ˆì •í™”

- **ëª©í‘œ**: 2ë‹¨ê³„ë¥¼ 'ì¼ë‹¨ êµ¬í˜„'í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **'ì™„ë²½í•˜ê²Œ ì•ˆì •í™”'**í•´ì•¼ í•©ë‹ˆë‹¤.
    
- 2ë‹¨ê³„ì—ì„œ `malloc`/`free` ì‹¤ìˆ˜ê°€ ìˆê±°ë‚˜ `connfd` ì „ë‹¬ì— ë¯¸ì„¸í•œ ë²„ê·¸ê°€ ë‚¨ì•„ìˆë‹¤ë©´, 3ë‹¨ê³„ ìºì‹œ ë²„ê·¸ì™€ ê²¹ì³ì„œ **ì ˆëŒ€ ë””ë²„ê¹…í•  ìˆ˜ ì—†ëŠ” ì§€ì˜¥**ì´ í¼ì³ì§‘ë‹ˆë‹¤.
    
- `valgrind --tool=memcheck --leak-check=full ...` (ë©”ëª¨ë¦¬ ë¦­ ê²€ì‚¬)ì™€ `valgrind --tool=helgrind ...` (ë ˆì´ìŠ¤ ì»¨ë””ì…˜ ê²€ì‚¬)ë¥¼ í†µí•´ 2ë‹¨ê³„ê°€ ì™„ë²½í•˜ë‹¤ê³  í™•ì‹ í•  ë•Œê¹Œì§€ ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ì§€ ë§ˆì„¸ìš”.
    

---

### 2. ğŸ“ ì ì‹¬ ì§í›„ (13:00 ~ 14:00): 3ë‹¨ê³„ 'ì„¤ê³„' (ì½”ë”© ê¸ˆì§€!)

- **ëª©í‘œ**: ì½”ë“œë¥¼ í•œ ì¤„ë„ ì§œì§€ ì•Šê³ , í™”ì´íŠ¸ë³´ë“œ(ë˜ëŠ” ì¢…ì´)ì— ìºì‹œì˜ **ìë£Œêµ¬ì¡°**ì™€ **ë½(Lock) ì „ëµ**ì„ ì™„ì„±í•©ë‹ˆë‹¤.
    
- ì´ê²Œ ë‚´ì¼ì˜ ì„±íŒ¨ë¥¼ ê°€ë¦…ë‹ˆë‹¤.
    

#### (1) ìë£Œêµ¬ì¡°: "ë¬´ì—‡ì„ ì“¸ ê²ƒì¸ê°€?"

- **ë¬¸ì œ**: ìºì‹œëŠ” ìš©ëŸ‰ì´ ì •í•´ì ¸ ìˆê³ (ì˜ˆ: 1MB), ê½‰ ì°¨ë©´ **LRU (Least Recently Used)** ì •ì±…ìœ¼ë¡œ í•˜ë‚˜ë¥¼ ì‚­ì œí•´ì•¼ í•©ë‹ˆë‹¤.
    
- **ìš”êµ¬ì‚¬í•­**:
    
    1. ë¹ ë¥¸ ê²€ìƒ‰ (URIë¡œ ìºì‹œëœ ê°ì²´ë¥¼ ì°¾ê¸°)
        
    2. ë¹ ë¥¸ ì‚­ì œ (LRU ê°ì²´ ì‚­ì œ)
        
    3. ë¹ ë¥¸ ì‚½ì… (ìƒˆ ê°ì²´ ì¶”ê°€)
        
    4. ë¹ ë¥¸ ê°±ì‹  (ìºì‹œëœ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ë©´ 'ìµœê·¼ ì‚¬ìš©'ìœ¼ë¡œ í‘œì‹œ)
        
- **í•´ê²°ì±…**:
    
    - **(êµê³¼ì„œì )**: O(1)ì„ ìœ„í•´ í•´ì‹œë§µ + ì´ì¤‘ ì—°ê²° ë¦¬ìŠ¤íŠ¸
        
    - **(Proxy Lab í˜„ì‹¤ì )**: ìºì‹œ í¬ê¸°ê°€ ì‘ìŠµë‹ˆë‹¤. O(1)ì— ì§‘ì°©í•  í•„ìš” ì—†ìŠµë‹ˆë‹¤.
        
    - **ì¶”ì²œ ìë£Œêµ¬ì¡°**: **ì´ì¤‘ ì—°ê²° ë¦¬ìŠ¤íŠ¸ (Doubly Linked List)** í•˜ë‚˜ë§Œìœ¼ë¡œ ì¶©ë¶„í•©ë‹ˆë‹¤.
        
        - **ê²€ìƒ‰**: `head`ë¶€í„° `tail`ê¹Œì§€ ìˆœíšŒ (O(N) - Nì€ ìºì‹œ ì—”íŠ¸ë¦¬ ìˆ˜, ì¶©ë¶„íˆ ë¹ ë¦„)
            
        - **ì‚½ì…**: `head`ì— ì¶”ê°€ (O(1))
            
        - **ì‚­ì œ(Eviction)**: `tail`ì—ì„œ ì œê±° (O(1))
            
        - **ê°±ì‹ (LRU)**: ì‚¬ìš©í•œ ë…¸ë“œë¥¼ ì°¾ì•„ì„œ `head`ë¡œ ì´ë™ (O(N) + O(1))
            

#### (2) ë½ ì „ëµ: "ì–´ë–»ê²Œ ì ê¸€ ê²ƒì¸ê°€?" (ê°€ì¥ ì¤‘ìš”!)

- **ë¬¸ì œ**: ìºì‹œëŠ” **ì „ì—­ ë³€ìˆ˜**ì…ë‹ˆë‹¤. ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì´ ì—°ê²° ë¦¬ìŠ¤íŠ¸ë¥¼ ì½ê³ , ì“°ê³ , ìˆœì„œë¥¼ ë°”ê¾¸ë ¤ê³  ë‹¬ë ¤ë“­ë‹ˆë‹¤.
    
- **í•´ê²°ì±…**:
    
    - **(ë‚˜ìœ ìƒê°)**: "ë½ ì—†ì´ ë˜ê² ì§€?" -> 100% ë¦¬ìŠ¤íŠ¸ê°€ ê¹¨ì§‘ë‹ˆë‹¤.
        
    - **(ê³ ê¸‰ ìƒê°)**: "Reader-Writer ë½ì„ ì“°ì!" -> í•˜ì§€ë§Œ ìºì‹œ 'ì½ê¸°'ê°€ LRU ê°±ì‹ (ë¦¬ìŠ¤íŠ¸ 'ì“°ê¸°')ì„ ìœ ë°œí•˜ë¯€ë¡œ, ëª¨ë“  'ì½ê¸°'ê°€ ì‚¬ì‹¤ìƒ 'ì“°ê¸°'ê°€ ë©ë‹ˆë‹¤. ë§¤ìš° ë³µì¡í•´ì§‘ë‹ˆë‹¤.
        
    - **(ìµœê³ ì˜ ìƒê°)**: **One Big Lock. ìºì‹œ ì „ì²´ë¥¼ í†µì œí•˜ëŠ” ë‹¨ í•˜ë‚˜ì˜ Mutex.**
        
        - `pthread_mutex_t cache_mutex;`
            
        - ìºì‹œ ë¦¬ìŠ¤íŠ¸ì— ì ‘ê·¼í•˜ëŠ” **ëª¨ë“ ** í•¨ìˆ˜(ê²€ìƒ‰, ì‚½ì…, ì‚­ì œ, ê°±ì‹ )ì˜ **ì‹œì‘ê³¼ ë**ì„ ì´ ë½ìœ¼ë¡œ ê°ìŒ‰ë‹ˆë‹¤.
            
        - **ì¥ì **: êµ¬í˜„ì´ ê°„ë‹¨í•˜ê³ , ë²„ê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.
            
        - **ë‹¨ì **: ë™ì‹œì„±ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤. (í•œ ìŠ¤ë ˆë“œê°€ ìºì‹œë¥¼ ë’¤ì§€ëŠ” ë™ì•ˆ ë‹¤ë¥¸ ìŠ¤ë ˆë“œëŠ” ìºì‹œ ì ‘ê·¼ì„ ëª» í•˜ê³  ê¸°ë‹¤ë ¤ì•¼ í•¨)
            
        - **ê²°ë¡ **: **Proxy Labì„ í†µê³¼í•˜ëŠ” ë°ëŠ” ì´ê²ƒë§Œìœ¼ë¡œ ì™„ë²½í•©ë‹ˆë‹¤.**
            

---

### 3. âŒ¨ï¸ ì˜¤í›„ (14:00 ~ ì €ë…): 3ë‹¨ê³„ 'êµ¬í˜„'

ì´ì œ í™”ì´íŠ¸ë³´ë“œì— ì„¤ê³„í•œ ë‚´ìš©ì„ ì½”ë“œë¡œ ì˜®ê¹ë‹ˆë‹¤.

#### (1) ìºì‹œ êµ¬ì¡°ì²´ ë° ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ (14:00 ~ 15:00)

C

```
// (í—¤ë” íŒŒì¼ì´ë‚˜ ì†ŒìŠ¤ ìƒë‹¨ì—)
struct CacheLine {
    char uri[MAX_LINE];       // ì´ ê°ì²´ì˜ URI (Key)
    void *data;               // ì‹¤ì œ ì›¹ ê°ì²´ ë°ì´í„° (Value)
    size_t size;              // ë°ì´í„° í¬ê¸°
    
    struct CacheLine *prev;   // LRU ë¦¬ìŠ¤íŠ¸ë¥¼ ìœ„í•œ í¬ì¸í„°
    struct CacheLine *next;
};

// ì „ì—­ ë³€ìˆ˜ (ìºì‹œ)
struct CacheLine *head;       // LRU ë¦¬ìŠ¤íŠ¸ì˜ head
struct CacheLine *tail;       // LRU ë¦¬ìŠ¤íŠ¸ì˜ tail
size_t g_total_cache_size;    // í˜„ì¬ ìºì‹œì˜ ì´ í¬ê¸°

// ì „ì—­ ë½
pthread_mutex_t cache_mutex;  // ìºì‹œë¥¼ ë³´í˜¸í•  ë‹¨ í•˜ë‚˜ì˜ ë½
```

#### (2) ìºì‹œ í—¬í¼ í•¨ìˆ˜ êµ¬í˜„ (15:00 ~ 17:00)

- **`cache_init()`**: `head = NULL`, `tail = NULL`, `g_total_cache_size = 0`, `pthread_mutex_init(&cache_mutex, NULL)`
    
- **`cache_find(char *uri)`**:
    
    - `pthread_mutex_lock(&cache_mutex);`
        
    - (ë¦¬ìŠ¤íŠ¸ë¥¼ `head`ë¶€í„° ìˆœíšŒí•˜ë©° `uri`ê°€ ì¼ì¹˜í•˜ëŠ” ë…¸ë“œ ì°¾ê¸°)
        
    - **(ì¤‘ìš”)** ì°¾ì•˜ë‹¤ë©´, ì´ ë…¸ë“œë¥¼ **ë¦¬ìŠ¤íŠ¸ì—ì„œ ë–¼ì–´ë‚´ì–´ `head`ë¡œ ì˜®ê¸°ëŠ” ì‘ì—…** ìˆ˜í–‰ (LRU ê°±ì‹ )
        
    - `pthread_mutex_unlock(&cache_mutex);`
        
    - (ì°¾ì€ ë…¸ë“œì˜ `data` ë°˜í™˜, ëª» ì°¾ìœ¼ë©´ `NULL`)
        
- **`cache_evict()`**:
    
    - (ë½ì€ ì´ í•¨ìˆ˜ë¥¼ ë¶€ë¥¸ `cache_insert`ê°€ ì´ë¯¸ ì¡ê³  ìˆìŒ)
        
    - `tail` ë…¸ë“œë¥¼ ì°¾ì•„ì„œ, ë¦¬ìŠ¤íŠ¸ì—ì„œ ì œê±°í•˜ê³ , `free(tail->data)`, `free(tail)`
        
    - `g_total_cache_size` ê°±ì‹ 
        
- **`cache_insert(char *uri, void *data, size_t size)`**:
    
    - `pthread_mutex_lock(&cache_mutex);`
        
    - (ìƒˆ `CacheLine` ë…¸ë“œ `malloc` ë° ì´ˆê¸°í™”)
        
    - **(ì¤‘ìš”)** `while ((g_total_cache_size + size) > MAX_CACHE_SIZE)`:
        
        - `cache_evict();` (ê³µê°„ í™•ë³´ë  ë•Œê¹Œì§€ ê¼¬ë¦¬ ì œê±°)
            
    - (ìƒˆ ë…¸ë“œë¥¼ `head`ì— ì‚½ì…)
        
    - `g_total_cache_size` ê°±ì‹ 
        
    - `pthread_mutex_unlock(&cache_mutex);`
        

#### (3) ë©”ì¸ ë¡œì§ì— ìºì‹œ ì ìš© (17:00 ~ 19:00)

- `handle_request` (ë˜ëŠ” `worker` ìŠ¤ë ˆë“œ í•¨ìˆ˜) ë¡œì§ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.
    

C

```
// 1. ìš”ì²­ íŒŒì‹± ...

// 2. ìºì‹œ í™•ì¸
struct CacheLine* cached_item = cache_find(uri);
if (cached_item != NULL) {
    // ìºì‹œ íˆíŠ¸!
    clientfd_send(clientfd, cached_item->data, cached_item->size);
    // (í•¨ìˆ˜ ì¢…ë£Œ)
}

// 3. ìºì‹œ ë¯¸ìŠ¤ (ê¸°ì¡´ 1, 2ë‹¨ê³„ ë¡œì§)
// (ì›ê²© ì„œë²„ì— ì—°ê²°, ìš”ì²­ ë³´ë‚´ê¸°)
// (ì›ê²© ì„œë²„ì—ì„œ ì‘ë‹µ ë°›ê¸° -> response_data, response_size)

// 4. ì‘ë‹µì„ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬
clientfd_send(clientfd, response_data, response_size);

// 5. (ìƒˆ ë¡œì§) ì‘ë‹µì„ ìºì‹œì— ì €ì¥
if (response_size <= MAX_OBJECT_SIZE) {
    cache_insert(uri, response_data, response_size); 
    // (ì£¼ì˜: response_dataë¥¼ insert í–ˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œ freeí•˜ë©´ ì•ˆ ë¨. 
    //  insertê°€ ë‚´ë¶€ì ìœ¼ë¡œ ë³µì‚¬ë³¸ì„ ë§Œë“¤ê±°ë‚˜ ì†Œìœ ê¶Œì„ ê°€ì ¸ì•¼ í•¨. 
    //  ì´ ë¶€ë¶„ì˜ ë©”ëª¨ë¦¬ ê´€ë¦¬ê°€ ë§ˆì§€ë§‰ í•¨ì •!)
} else {
    free(response_data); // ë„ˆë¬´ ì»¤ì„œ ìºì‹œ ëª»í•˜ë©´ ê·¸ëƒ¥ free
}
```

### 4. ğŸŒ™ ì €ë… (19:00 ~ ): ë””ë²„ê¹… ë° ì•ˆì •í™”

BOJ ê³¨ë“œ 2 ì‹¤ë ¥ì´ë©´ ì´ì¤‘ ì—°ê²° ë¦¬ìŠ¤íŠ¸ í¬ì¸í„° ì¡°ì‘(`head`ë¡œ ì˜®ê¸°ê¸°, `tail` ì‚­ì œí•˜ê¸°)ì—ì„œ ë°œìƒí•˜ëŠ” ë²„ê·¸ë¥¼ ê¸ˆë°© ì¡ìœ¼ì‹¤ ê²ë‹ˆë‹¤.

**ê²°ë¡ :** ì‚¬ìš©ìë‹˜ì˜ ì‹¤ë ¥ì´ë©´ **ì¶©ë¶„íˆ ê°€ëŠ¥í•©ë‹ˆë‹¤.** 2ë‹¨ê³„ ì•ˆì •í™”ì— ì‹œê°„ì„ ì•„ë¼ì§€ ë§ˆì‹œê³ , 3ë‹¨ê³„ëŠ” **'One Big Lock'** ì „ëµì„ ì“°ì„¸ìš”. ë‚´ì¼ ì €ë…ì—” ìºì‹œê°€ ë™ì‘í•˜ëŠ” ê²ƒì„ ë³´ì‹¤ ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤.