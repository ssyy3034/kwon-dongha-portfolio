---
date: 2025-10-30
tags: [CS]
---


## ## UNIX I/O의 핵심 원칙

유닉스(UNIX) 철학의 핵심은 **모든 I/O 디바이스(키보드, 디스크, 네트워크 등)를 파일로 모델링**하는 것입니다. 따라서 모든 입력과 출력 작업은 단순히 해당 파일을 읽거나 쓰는 방식으로 동일하게 수행됩니다. 이를 위해 운영체제는 **UNIX I/O**라는 저수준(low-level) 응용 인터페이스를 제공합니다.

### ### 1. 파일 열기 (`open`)

응용 프로그램이 I/O 장치를 사용하려면, 가장 먼저 커널에 "이 파일을 사용하겠습니다"라고 알려야 합니다.

- **요청과 응답:** 프로그램이 `open`을 호출하면, 커널은 요청을 처리한 뒤 **[[크래프톤 정글/02_CSAPP/10장/10.1 ~ 10.3/개념들/파일 디스크립터]]** 라는 작은 음수가 아닌 정수(ID)를 반환합니다. 만약 음수가 반환되면 열기에 실패한 것입니다.
    
- **커널의 권한 확인 절차:** 파일을 열기 전, 커널 내의 **[[VFS (가상 파일 시스템)]]** 는 다음 세 가지를 확인합니다.
    
    1. 요청한 파일에 설정된 **권한**은 무엇인가? (읽기/쓰기/실행)
        
    2. 프로그램을 실행한 **사용자**가 해당 권한을 가지고 있는가?
        
    3. 프로그램이 요청한 **접근 방식**(`flags`)이 파일의 권한과 일치하는가?
        
- **성공 시:** 모든 검사를 통과하면, 커널은 이 파일에 대한 정보를 자신의 **Open File Table**에 등록하고, 테이블의 특정 항목을 가리키는 파일 디스크립터를 프로그램에 발급합니다. 이후 프로그램은 이 디스크립터를 통해 파일과 관련된 모든 작업을 수행합니다.
    

### ### 2. 파일 위치 변경 (`seek`)

커널은 열려있는 모든 파일에 대해 **현재 파일 위치(current file position)** 를 관리합니다.

- 이는 파일의 시작점으로부터 얼마나 떨어져 있는지를 나타내는 **커서(cursor) 또는 책갈피**와 같은 개념입니다.
    
- `read`나 `write`를 하면 이 위치는 자동으로 앞으로 이동하지만, `seek` 시스템 콜을 사용하면 원하는 위치로 **명시적으로 이동**시킬 수 있습니다.
    

### ### 3. 파일 읽기와 쓰기 (`read`, `write`)

- **읽기 연산:** 현재 파일 위치에서부터 지정된 바이트 수만큼 데이터를 **파일에서 메모리로** 복사합니다.
    
- **쓰기 연산:** 현재 파일 위치에 지정된 바이트 수만큼 데이터를 **메모리에서 파일로** 복사합니다.
    
- **파일의 끝 [[EOF (End-of-File)]]:** 파일의 모든 내용을 읽어 더 이상 읽을 데이터가 없는 상태가 되면 **EOF (End-of-File)** 조건이 발생합니다.
    
    - 프로그램은 `read` 함수의 **반환 값**으로 이 상태를 감지할 수 있습니다.
        
        - **양수 `n`:** `n` 바이트만큼 읽기 성공.
            
        - **`0`:** 파일의 끝(EOF)에 도달하여 아무것도 읽지 못함.
            
        - **`-1`:** 에러 발생.
            

### ### 4. 파일 닫기 (`close`)

파일 사용이 끝나면 반드시 커널에 알려 자원을 정리해야 합니다.

- **참조 카운트(Reference Count):** `close`가 호출되면, 커널은 해당 파일의 Open File Table 항목에 있는 **참조 카운트를 1 감소**시킵니다.
    
- **자원 해제:** 이 참조 카운트가 **최종적으로 0이 되었을 때**, 커널은 비로소 해당 파일과 관련된 모든 자원을 메모리에서 해제합니다.
    
- **카운트 증가 조건:** 참조 카운트는 프로세스가 복제되거나(`fork()`) 파일 디스크립터가 복제될 때(`dup()`, `dup2()`) 증가합니다. 이 때문에 공유된 파일은 모든 주체가 `close`를 해야만 완전히 닫힙니다.