---
date: 2025-10-30
tags: [CS]
---

커널은 **디스크립터 테이블**, **파일 테이블**, **v-node 테이블**이라는 세 가지 자료 구조를 통해 파일을 공유합니다.

- **프로세스 간 파일 공유 (`fork`)**:
    
    - 프로세스가 `fork`를 호출하면, 자식 프로세스는 부모의 **디스크립터 테이블을 그대로 복사**해서 가집니다.
        
    - 중요한 점은 부모와 자식의 디스크립터 테이블이 **동일한 파일 테이블 항목**을 가리킨다는 것입니다.
        
    - 그 결과, 부모와 자식은 **같은 파일 위치(file position)를 공유**하게 됩니다.
        
    - 이때 해당 파일 테이블 항목의 참조 카운트는 1 증가합니다. 따라서 부모와 자식이 모두 `close`를 호출하여 참조 카운트가 0이 되어야만 커널이 해당 파일 테이블 항목을 삭제합니다.
        
- **다중 디스크립터 공유**:
    
    - 한 프로세스가 같은 파일을 `open` 함수로 두 번 호출하는 경우, 두 개의 다른 디스크립터가 생성됩니다.
        
    - 이 디스크립터들은 **각자 별개의 파일 테이블 항목**을 가리키게 됩니다.
        
    - 따라서 각 디스크립터는 **독립적인 파일 위치**를 가지게 되지만, 두 파일 테이블 항목은 **동일한 v-node 테이블 항목**을 가리켜 같은 파일 데이터를 공유하게 됩니다.