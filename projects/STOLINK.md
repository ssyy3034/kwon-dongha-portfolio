# StoLink - í”„ë¡ íŠ¸ì—”ë“œ ê¸°ìˆ  ì±Œë¦°ì§€

> 5ì¸ íŒ€ í”„ë¡œì íŠ¸ | **í”„ë¡ íŠ¸ì—”ë“œ ë‹¨ë… ë‹´ë‹¹** | React + TypeScript + D3.js

ì‘ê°€ìš© ì›¹ ì—ë””í„° ë° ìºë¦­í„° ê´€ê³„ë„ ì‹œê°í™” ì„œë¹„ìŠ¤ì˜ í”„ë¡ íŠ¸ì—”ë“œ ì „ì²´ë¥¼ ì„¤ê³„í•˜ê³  êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

---

## 1. SVG â†’ Canvas ë§ˆì´ê·¸ë ˆì´ì…˜ìœ¼ë¡œ ë Œë”ë§ ì„±ëŠ¥ 16ë°° ê°œì„ 

### ë¬¸ì œ ìƒí™©

D3.js ê¸°ë°˜ ìºë¦­í„° ê´€ê³„ë„ì—ì„œ ë…¸ë“œê°€ 30ê°œë¥¼ ë„˜ì–´ì„œì ì‹¬ê°í•œ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

- **í˜„ìƒ**: ì¤Œ/íŒ¬ ì¡°ì‘ ì‹œ FPS 10 ë¯¸ë§Œ, ë“œë˜ê·¸ ì‹œ ì…ë ¥ ì§€ì—°
- **ì›ì¸**: ë§¤ í”„ë ˆì„ë§ˆë‹¤ ìˆ˜ë°± ê°œ DOM ìš”ì†Œì˜ Style Recalculation ë°œìƒ (í”„ë ˆì„ë‹¹ 935ms)

### í•´ê²° ê³¼ì •

SVG(DOM) ê¸°ë°˜ ë Œë”ë§ì„ Canvas APIë¡œ ì „ë©´ ì „í™˜í–ˆìŠµë‹ˆë‹¤.

1. **Single Layer Rendering**: ê°œë³„ DOM ë…¸ë“œ ëŒ€ì‹  Canvas ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì¼ê´„ ë“œë¡œì‰
2. **Image Caching**: ìºë¦­í„° ì´ë¯¸ì§€ë¥¼ í…ìŠ¤ì²˜ë¡œ ë©”ëª¨ë¦¬ì— ìºì‹±
3. **Color-based Hit Detection**: Canvasì—ì„œ í´ë¦­ ì´ë²¤íŠ¸ ê°ì§€ë¥¼ ìœ„í•œ O(1) íˆíŠ¸ë§µ êµ¬í˜„

### ì„±ê³¼ (Chrome DevTools ì¸¡ì •)

| ì§€í‘œ                | Before (SVG) | After (Canvas) | ê°œì„             |
| :------------------ | :----------- | :------------- | :-------------- |
| **INP (ì‘ë‹µ ì†ë„)** | 1,048ms      | 64ms           | **16.3ë°° í–¥ìƒ** |
| **LCP (ì´ˆê¸° ë¡œë“œ)** | 2.30s        | 0.58s          | **4ë°° í–¥ìƒ**    |
| **Style Recalc**    | 935ms/frame  | ~0ms           | **100% ì œê±°**   |
| **FPS**             | 5~10         | 60 (stable)    | **6ë°° í–¥ìƒ**    |
| **ì²˜ë¦¬ ë…¸ë“œ ìˆ˜**    | 28ê°œ í•œê³„    | 600ê°œ ì´ìƒ     | **21ë°° í™•ì¥**   |

---

## 2. ğŸ¤– AI ì—ì´ì „íŠ¸ ê¸°ë°˜ ê°œë°œ ì›Œí¬í”Œë¡œìš° ìë™í™”

### ë°°ê²½ ë° ë¬¸ì œ ìƒí™©

1. **Git ë²„ì „ ê´€ë¦¬ì˜ ì–´ë ¤ì›€**: íŒ€ì›ë“¤ì˜ Git í™œìš© ìˆ™ë ¨ë„ ê²©ì°¨ë¡œ ì¸í•´ ë¸Œëœì¹˜ ì „ëµ ì¤€ìˆ˜ê°€ ì–´ë µê³ , Conflictë¡œ ì¸í•œ ê°œë°œ ì§€ì—° ë°œìƒ.
2. **ì´ìŠˆ íŠ¸ë˜í‚¹ê³¼ ì½”ë“œì˜ ë‹¨ì ˆ**: ì»¤ë°‹ê³¼ ì´ìŠˆ ì—°ê²°ì´ ëˆ„ë½ë˜ì–´ íˆìŠ¤í† ë¦¬ íŒŒì•…ì´ ì–´ë ¤ì›€.
3. **ì¼ê´€ì„± ì—†ëŠ” ì½”ë“œ í’ˆì§ˆ**: êµ¬ë‘ë¡œ í•©ì˜ëœ ì»¨ë²¤ì…˜ì´ ì‹¤ì œ ì½”ë“œì— ë°˜ì˜ë˜ì§€ ì•ŠìŒ.

### í•´ê²° ë°©ë²• 1: `Smart-Commit` & ì´ìŠˆ ìˆ˜ëª…ì£¼ê¸° ìë™í™”

ë‹¨ìˆœí•œ ì»¤ë°‹ì´ ì•„ë‹Œ, **"ì´ìŠˆ ìƒì„±ë¶€í„° PRê¹Œì§€"**ì˜ ì „ì²´ ìˆ˜ëª…ì£¼ê¸°(Lifecycle)ë¥¼ ìë™í™”í•˜ëŠ” CLI íŒŒì´í”„ë¼ì¸ êµ¬ì¶•.

- **Cross-Repo Issue Automation**: `./scripts/start-work.sh` ëª…ë ¹ì–´ë¡œ ì´ìŠˆ ìƒì„± ë° ë¸Œëœì¹˜ ì „ëµ ê°•ì œ.
- **Auto Linking**: ì»¤ë°‹ ì‹œ ë¸Œëœì¹˜ëª…ì—ì„œ ì´ìŠˆ ë²ˆí˜¸ë¥¼ íŒŒì‹±í•˜ì—¬ ìë™ ì—°ê²°.
- **Lazy Creation**: ì´ìŠˆ ì—†ì´ ì‘ì—… ì‹œì‘ ì‹œ ìë™ìœ¼ë¡œ ì›ê²© ì´ìŠˆ ìƒì„±.

### í•´ê²° ë°©ë²• 2: Supervisor Agent System (Role-Based Delegation)

ì²´ê³„ì ì¸ ë¶„ì—… ì‹œìŠ¤í…œì„ AI ì—ì´ì „íŠ¸ì— ì ìš©í•˜ì—¬ **"ì§€ì‹œëŠ” ë‚´ê°€, ì‘ì—…ì€ ì—ì´ì „íŠ¸ê°€"** ìˆ˜í–‰í•˜ëŠ” êµ¬ì¡° í™•ë¦½.

- **Supervisor**: ì‚¬ìš©ìì˜ ìš”ì²­ì„ ê¸°ìˆ  ëª…ì„¸ë¡œ ë³€í™˜í•˜ê³  ì‘ì—… í¬ê¸°(S/M/L) íŒë‹¨.
- **Dynamic Context Injection**: ì‘ì—… í¬ê¸°ì— ë”°ë¼ í•„ìš”í•œ ë¬¸ë§¥(Context)ë§Œ ë™ì ìœ¼ë¡œ ì£¼ì…í•˜ì—¬ í† í° ë¹„ìš© ì ˆê° ë° ì •í™•ë„ í–¥ìƒ.
  - _S ì‚¬ì´ì¦ˆ_: ë””ìì¸ í† í°ë§Œ ì°¸ì¡°í•˜ëŠ” 'Stylist Agent' í˜¸ì¶œ
  - _L ì‚¬ì´ì¦ˆ_: ì „ì²´ ì•„í‚¤í…ì²˜ë¥¼ ì°¸ì¡°í•˜ëŠ” 'Architect Agent' í˜¸ì¶œ

### í•´ê²° ë°©ë²• 3: Quality Gates & Aesthetic Consistency Protocol

ë‹¨ìˆœí•œ ë¦°íŠ¸ ì²´í¬ë¥¼ ë„˜ì–´, **"ì‚¬ìš©ì ê²½í—˜ì˜ ì‹¬ë¯¸ì  í’ˆì§ˆ(Aesthetic Consistency)"**ê¹Œì§€ ê²€ì¦í•˜ëŠ” ìë™í™”ëœ ê°ì‚¬ í”„ë¡œí† ì½œ (`AUDIT.md`) ë„ì….

- **Phase 1: Architecture Integrity**: Zustand, Query Key íŒ¨í„´ ë“± ë‚´ë¶€ ì•„í‚¤í…ì²˜ ê·œì¹™ ê²€ì‚¬.
- **Phase 2: Design Compliance**: ë¸Œëœë“œ ì»¬ëŸ¬ ì¤€ìˆ˜ ì—¬ë¶€ ë° ì• ë‹ˆë©”ì´ì…˜ ì ìš© ì—¬ë¶€ ê²€ì‚¬.

### í•µì‹¬ ì„±ê³¼

- **ì›Œí¬í”Œë¡œìš° ìë™í™” ì‹œìŠ¤í…œ êµ¬í˜„**: Git, Jira, ì»¨ë²¤ì…˜ ê²€ì‚¬ë¥¼ ìë™í™”í•˜ì—¬ ê°œë°œ ì™¸ì ì¸ ì¸ì§€ ë¶€í•˜ ì™„ì „ ì œê±°.
- **Code Quality 100% í‘œì¤€í™”**: AI ì—ì´ì „íŠ¸ì˜ ê°•ì œì  ê°ìˆ˜ë¥¼ í†µí•´ êµ¬ì„±ì› ì „ì›ì´ ë™ì¼í•œ ìˆ˜ì¤€ì˜ ì½”ë“œ í’ˆì§ˆ ìœ ì§€.
- **ì¡°ì§ ì „ì²´ë¡œ í™•ì‚°**: ê°œì¸ ìƒì‚°ì„± ë„êµ¬ë¡œ ì‹œì‘í•˜ì—¬ íŒ€ í‘œì¤€ìœ¼ë¡œ ì •ì°©, ì´í›„ 4ê°œ íŒ€ ì¤‘ 3íŒ€(15/20ëª…)ê¹Œì§€ ì „íŒŒë˜ì–´ ê¸°ìˆ˜ ì „ì²´ì˜ ìƒì‚°ì„±ì„ ê²¬ì¸.
- **ë¬¸ì„œí™”ì˜ ìë™ ë™ê¸°í™”**: ì½”ë“œê°€ ë³€í•˜ë©´ ë¬¸ì„œë„ ê°™ì´ ì§„í™”í•˜ëŠ” `Sync-Docs` ì›Œí¬í”Œë¡œìš° êµ¬í˜„.

---

## 3. ï¿½ ë²ˆë“¤ë§ ì „ëµ ë° ë¡œë”© ì„±ëŠ¥ ìµœì í™” (ì´ˆê¸° ë¡œë”© 60% ê°œì„ )

### ë¬¸ì œ ìƒí™©

ì´ˆê¸° ë¡œë”© ì‹œ ì—ë””í„°(Tiptap)ì™€ ê·¸ë˜í”„(D3/ReactFlow) ë“± ë¬´ê±°ìš´ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í¬í•¨ëœ ê±°ëŒ€í•œ ë²ˆë“¤ë¡œ ì¸í•´ **FCP** ë° **TTI** ì§€ì—° ë°œìƒ.

### í•´ê²° ê³¼ì •

1. **Route-based Code Splitting**: `React.lazy`ì™€ `Suspense`ë¡œ í˜ì´ì§€ ë‹¨ìœ„ ì§€ì—° ë¡œë”© ì ìš©.
2. **Vendor Chunk Splitting**: `vite.config.ts`ì˜ `manualChunks`ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìš©ë„ë³„ë¡œ ë¶„ë¦¬.

```typescript
// vite.config.ts
build: {
  rollupOptions: {
    output: {
      manualChunks: {
        'vendor-react': ['react', 'react-dom'],
        'vendor-editor': ['@tiptap/core', '@tiptap/react'], // ì—ë””í„° ì§„ì… ì‹œì—ë§Œ ë¡œë“œ
        'vendor-graph': ['d3', 'reactflow'] // ê´€ê³„ë„ í˜ì´ì§€ ì§„ì… ì‹œì—ë§Œ ë¡œë“œ
      }
    }
  }
}
```

### ì„±ê³¼

| ì§€í‘œ               | Before | After | ê°œì„          |
| :----------------- | :----- | :---- | :----------- |
| **ì´ˆê¸° JS (gzip)** | 450KB  | 187KB | **60% ê°ì†Œ** |
| **EditorPage**     | 251KB  | 131KB | **48% ê°ì†Œ** |
| **ExportPage**     | 365KB  | 26KB  | **93% ê°ì†Œ** |
| **ìºì‹œ íš¨ìœ¨ì„±**    | ~40%   | ~85%  | **+45%p**    |

---

## 4. ğŸŒ³ íŠ¸ë¦¬ êµ¬ì¡° ê³„ì‚° ë©”ëª¨ì´ì œì´ì…˜ (O(n log n) â†’ O(1))

### ë¬¸ì œ ìƒí™©

ë¬¸ì„œ ì‚¬ì´ë“œë°” ë Œë”ë§ ì‹œ, í´ë¦­/í˜¸ë²„ ë“± ë‹¨ìˆœ ì¸í„°ë™ì…˜ì—ë„ `buildTree` í•¨ìˆ˜(O(n log n))ê°€ ë§¤ë²ˆ ì‹¤í–‰ë˜ì–´ ë¶ˆí•„ìš”í•œ ì—°ì‚° ë¶€í•˜ ë°œìƒ.

### í•´ê²° ê³¼ì •

**ì°¸ì¡° ë™ë“±ì„±(Referential Equality)**ì„ í™œìš©í•˜ì—¬, ë°ì´í„°(`documents` ë°°ì—´)ê°€ ì‹¤ì œë¡œ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ íŠ¸ë¦¬ ë³€í™˜ì„ ìˆ˜í–‰í•˜ë„ë¡ `useMemo` ì ìš©.

```typescript
// Before: ë Œë”ë§ë§ˆë‹¤ ë¬´ê±°ìš´ ì—°ì‚° ì‹¤í–‰
const tree = buildTree(documents);

// After: documents ë°°ì—´ì˜ "ì°¸ì¡°"ê°€ ë°”ë€” ë•Œë§Œ ì¬ì—°ì‚°
const tree = useMemo(() => buildTree(documents), [documents]);
```

### ì„±ê³¼

- **99% ì—°ì‚° ì œê±°**: ë°ì´í„° ë³€ê²½ ì—†ëŠ” ì¸í„°ë™ì…˜ ì‹œ ì—°ì‚° ë¹„ìš© **0ms**
- **GC ë¶€í•˜ ê°ì†Œ**: ë§¤ ë Œë”ë§ë§ˆë‹¤ ë°œìƒí•˜ë˜ ë¶ˆí•„ìš”í•œ ê°ì²´ ìƒì„±/íê¸° ì œê±°
- **ì¦‰ê°ì  ë°˜ì‘ì„±**: ë…¸ë“œ í™•ì¥/ì¶•ì†Œ ë™ì‘ì´ ì§€ì—° ì—†ì´ ì¦‰ì‹œ ë°˜ì˜

---

## 5. Tiptap ì—ë””í„° ì¸ìŠ¤í„´ìŠ¤ ì•ˆì •í™” (useRef íŒ¨í„´)

### ë¬¸ì œ ìƒí™©

Tiptap ì—ë””í„°ì—ì„œ ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ ë¦¬ë Œë”ë§ ì‹œ `onUpdate` ì½œë°±ì´ ë³€ê²½ë˜ì–´ ì—ë””í„° ì¸ìŠ¤í„´ìŠ¤ê°€ ì¬ìƒì„±ë˜ëŠ” ë¬¸ì œ ë°œìƒ. ì´ë¡œ ì¸í•´ íƒ€ì´í•‘ ë„ì¤‘ **ì»¤ì„œ ìœ„ì¹˜ ì´ˆê¸°í™”** ë° **ì…ë ¥ ì”¹í˜** í˜„ìƒ ë°œìƒ.

### í•´ê²° ê³¼ì •

**Stable Callback Ref íŒ¨í„´**ìœ¼ë¡œ ì˜ì¡´ì„±ê³¼ ì½œë°± ìµœì‹ ì„±ì„ ë¶„ë¦¬í•˜ì—¬ í•´ê²°.

```typescript
// After: ref.currentë§Œ ê°±ì‹ , ì—ë””í„°ëŠ” ìµœì´ˆ 1íšŒë§Œ ìƒì„±
const onUpdateRef = useRef(onUpdate);

useEffect(() => {
  onUpdateRef.current = onUpdate;
}, [onUpdate]);

const editor = useEditor(
  {
    onUpdate: ({ editor }) => {
      onUpdateRef.current?.(editor.getHTML());
    },
  },
  [],
); // ì˜ì¡´ì„± ë¹ˆ ë°°ì—´ â†’ ì¬ìƒì„± ë°©ì§€
```

### ì„±ê³¼

- ì—ë””í„° ì¬ìƒì„± **0íšŒ** ìœ ì§€
- ì¹˜ëª…ì ì¸ ì…ë ¥ UX ë²„ê·¸(ì»¤ì„œ íŠ, ì”¹í˜) ì™„ì „ ì œê±°

---

## 6. ğŸš… Optimistic UI (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)

### ë¬¸ì œ ìƒí™©

ë¬¸ì„œ ìƒì„±/ì‚­ì œ ì‹œ ì„œë²„ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ UIê°€ ë©ˆì¹«í•˜ì—¬ ì‚¬ìš©ì ê²½í—˜ ì €í•´.

### í•´ê²° ê³¼ì •

**TanStack Query**ì™€ **Zustand**ë¥¼ ì—°ë™í•˜ì—¬, ì„œë²„ ìš”ì²­ê³¼ ë™ì‹œì— ë¡œì»¬ UI ìƒíƒœë¥¼ ë¨¼ì € ì—…ë°ì´íŠ¸í•˜ê³  ì‹¤íŒ¨ ì‹œ ë¡¤ë°±í•˜ëŠ” ì „ëµ ì±„íƒ.

```typescript
const deleteDocument = useCallback(async (id: string) => {
  const previousData = queryClient.getQueryData(["documents", projectId]);

  // Optimistic Update: ì¦‰ì‹œ UI ë°˜ì˜
  _delete(id);
  queryClient.setQueryData(["documents", projectId], (old) =>
    old.filter((d) => d.id !== id),
  );

  try {
    await documentService.delete(id);
  } catch (error) {
    // Rollback
    queryClient.setQueryData(["documents", projectId], previousData);
    _create(deletedDoc);
  }
}, []);
```

### ì„±ê³¼

- **ì²´ê° ì§€ì—° Zero**: ë„¤ì´í‹°ë¸Œ ì•± ìˆ˜ì¤€ì˜ ì¦‰ê°ì ì¸ ë°˜ì‘ì„± í™•ë³´

---

## 7. ğŸ–¼ ì´ë¯¸ì§€ ë¡œë”© UX ìµœì í™”

### ë¬¸ì œ ìƒí™©

ì´ë¯¸ì§€ ë¡œë”© ì „ **CLS(Layout Shift)** í˜„ìƒê³¼ ê³ í•´ìƒë„ ì´ë¯¸ì§€ì˜ ê¹œë¹¡ì„ ë°œìƒ.

### í•´ê²° ê³¼ì •

`PerformanceImage` ì»´í¬ë„ŒíŠ¸ êµ¬í˜„:

1. **Aspect Ratio Reservation**: ë¹„ìœ¨ ê¸°ë°˜ìœ¼ë¡œ ê³µê°„ì„ ë¯¸ë¦¬ í™•ë³´í•˜ì—¬ CLS ë°©ì§€ (Score 0).
2. **Progressive Loading**: ì €í™”ì§ˆ ì¸ë„¤ì¼(Blur) â†’ ê³ í™”ì§ˆ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ ì ìš©.
3. **Preload Hint**: ì¤‘ìš” ì´ë¯¸ì§€(`priority` ì†ì„±)ì— ëŒ€í•´ `<link rel="preload">` ë™ì  ì£¼ì….

---

## 8. ğŸ”’ ê²¬ê³ í•œ ì—”ì§€ë‹ˆì–´ë§ (TypeScript & Memory)

### TypeScript íƒ€ì… ì•ˆì „ì„± ê°•í™”

API ì—ëŸ¬ ì²˜ë¦¬ ë“±ì—ì„œ `any` ì‚¬ìš©ì„ ì§€ì–‘í•˜ê³ , **Type Guard** í•¨ìˆ˜(`axios.isAxiosError`)ë¥¼ í™œìš©í•˜ì—¬ ëŸ°íƒ€ì„ ì•ˆì •ì„± í™•ë³´.

### ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€

D3 Selectionì´ë‚˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ í›„ì—ë„ ë‚¨ì•„ìˆëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `useEffect` cleanup í•¨ìˆ˜ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ìºì‹œ ë° ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬.

```typescript
useEffect(() => {
  return () => groupSelectionCache.current.clear(); // Cleanup
}, []);
```

---

## Tech Stack

| ì˜ì—­              | ê¸°ìˆ                                        |
| :---------------- | :----------------------------------------- |
| **Core**          | React 19, TypeScript 5.7, Vite             |
| **State**         | Zustand (17 stores), TanStack Query        |
| **Visualization** | Canvas API, D3.js, react-force-graph-2d    |
| **Editor**        | Tiptap (16ê°œ ì»¤ìŠ¤í…€ ìµìŠ¤í…ì…˜), ProseMirror |
| **Storage**       | IndexedDB (idb-keyval)                     |

---

## ğŸ“Š í•µì‹¬ ì„±ê³¼ ìš”ì•½

| ì˜ì—­           | ê°œì„  ë‚´ìš©                        | íš¨ê³¼                                            |
| :------------- | :------------------------------- | :---------------------------------------------- |
| **Rendering**  | useCallback, RAF ìµœì í™”          | 60fps ì•ˆì •í™”                                    |
| **Tree Calc**  | useMemo ë©”ëª¨ì´ì œì´ì…˜             | ì—°ì‚° ë¹„ìš© 99% ê°ì†Œ (O(n log n) â†’ O(1))          |
| **Bundling**   | Manual Chunks, Lazy Load         | ì´ˆê¸° ë¡œë”© JS ì‚¬ì´ì¦ˆ ê°ì†Œ, ìºì‹œ íš¨ìœ¨ ì¦ëŒ€        |
| **UX/Network** | Optimistic UI Updates            | ì²´ê° ë ˆì´í„´ì‹œ 0ms, ì¦‰ê°ì  ë°˜ì‘ì„±                |
| **DevOps**     | **Smart-Commit & Issue Linking** | **ë³µì¡í•œ ì´ìŠˆ íŠ¸ë˜í‚¹ 100% ìë™í™”**              |
| **Workflow**   | **Supervisor Agent**             | **Automated Workflow, "Aesthetic" í’ˆì§ˆ í‘œì¤€í™”** |
