---
date: 2025-11-13
tags: [CS]
---

ㅇ
# 1. CPU 권한 수준(Privilege Level)

| 항목      | 유저 모드              | 커널 모드                    |
| ------- | ------------------ | ------------------------ |
| 특권 레벨   | 낮음(Ring 3 / CPL=3) | 높음(Ring 0 / CPL=0)       |
| 허용 명령어  | 제한됨                | 모든 명령어 실행 가능             |
| 하드웨어 접근 | 불가                 | 직접 접근 가능(I/O, 제어 레지스터 등) |

CPU는 **하드웨어적으로** 유저 모드에서 실행 가능한 명령어 범위를 제한한다.
CPL은 하드웨어적으로 4개 지원. 00 01 10 11 근데 커널 vs 유저밖에 안써서 0과 3 사용.

---

# 2. 메모리 접근 권한

|항목|유저 모드|커널 모드|
|---|---|---|
|커널 영역 접근|불가능 (접근 시 page fault)|전체 주소 공간 접근 가능|
|페이지 권한 비트|`U=1` 페이지만 접근 가능|`U=0` 포함 모든 페이지 접근 가능|

✓ Pintos에서는 페이지 디렉토리(pagedir)에서  
**유저 페이지(U=1)** / **커널 페이지(U=0)** 로 구분함.

유저 모드 코드가 커널 페이지 접근 → 즉시 page fault → 프로세스 kill.
- 페이지 테이블 검사
    
- 접근 가능한지 확인
    
- 규칙 위반 → **page fault 예외 (#PF, interrupt vector 14)** 생성
    
- 커널의 page fault handler로 제어 전달

---

# 3. 실행 스택 차이

| 항목  | 유저 모드 스택         | 커널 모드 스택               |
| --- | ---------------- | ---------------------- |
| 위치  | 유저 주소 공간         | 커널 주소 공간               |
| 목적  | 유저 프로그램의 로컬 데이터  | 시스템 콜·예외 처리용 안정적 스택    |
| 변경  | 유저 프로그램이 마음대로 사용 | TSS 또는 인터럽트 진입 시 자동 전환 |

인터럽트나 시스템 콜 발생 시 CPU는 **유저 스택 → 커널 스택으로 자동 전환**한다.

---

# 4. 시스템 콜 / 인터럽트 처리 가능 여부

| 항목       | 유저 모드           | 커널 모드            |
| -------- | --------------- | ---------------- |
| 시스템 콜 호출 | 가능 (`int 0x30`) | 처리 담당            |
| 인터럽트 처리  | 불가              | 모든 하드웨어 인터럽트 처리  |
| 예외 처리    | 불가              | 페이지 폴트·0나누기 등 처리 |

유저 모드에서 직접 커널 코드를 실행할 방법은 **오직 시스템 콜**뿐이다.

---

# 5. 명령어 사용 제한

| 항목                                    | 유저 모드 | 커널 모드 |
| ------------------------------------- | ----- | ----- |
| [[hlt]], `lgdt`, `lidt`, `cli`, `sti` | 금지    | 허용    |
| 제어 레지스터(cr3 등) 수정                     | 불가능   | 가능    |
| I/O 명령어(`in`, `out`)                  | 불가능   | 가능    |

✓ Pintos 기준 유저 모드에서 금지된 명령 실행 → 예외 → 프로세스 종료.

---

# 6. OS 자원 접근 범위

|항목|유저 모드|커널 모드|
|---|---|---|
|파일 시스템 접근|시스템 콜 경유|직접 접근|
|스케줄러 제어|불가|가능|
|메모리 관리|불가|페이지 테이블 조작 가능|

	유저 모드는 어떤 OS 자원에도 직접 접근하지 못하며 **항상 커널이 중개한다.**

---

# 7. 모드 전환 조건

**유저 → 커널 전환**

- 시스템 콜
    
- 인터럽트
    
- 예외(page fault 등)
    

**커널 → 유저 전환**

- `intr_exit()` (x86 기준 iret 포함)
    
- 준비된 유저 레지스터 세트로 복귀
    

Pintos에서 유저 프로그램 시작은 항상  
`intr_exit()`을 통해 CPL=3으로 내려가며 시작된다.

---

# 핵심 요약 (Shortest form)

1. **CPU 권한:** 유저는 제한됨, 커널은 전체 제어
    
2. **메모리:** 유저는 U=1 페이지만, 커널은 모든 페이지 접근
    
3. **명령어:** 유저는 제한, 커널은 모든 특권 명령 사용
    
4. **자원 접근:** 유저는 시스템 콜로만 요청 가능
    
5. **스택:** 유저 스택과 커널 스택 분리
    
6. **모드 전환:** syscall/interrupt/exception → 커널, iret → 유저
    
